{"ast":null,"code":"import { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nvar _jsxFileName = \"/Volumes/document/GitHub/ASM3/Frontend Assignment 03/client/src/Share/Chat/Chat.jsx\",\n    _s = $RefreshSig$();\n\nimport React, { useEffect, useRef, useState } from 'react';\nimport './Chat.css';\nimport queryString from 'query-string';\nimport io from 'socket.io-client';\nimport MessengerAPI from '../../API/MessengerAPI';\nconst socket = io('http://localhost:5001'); // Thay đổi URL của server Socket.IO tại đây\n\nfunction Chat() {\n  _s();\n\n  const [activeChat, setActiveChat] = useState(false);\n  const [textMessage, setTextMessage] = useState('');\n  const [message, setMessage] = useState([]);\n  const id_admin = '5ff808424e24e9118cee77b2';\n  const id_user = localStorage.getItem('idUser');\n  const [loadMessage, setLoadMessage] = useState('');\n  const [load, setLoad] = useState(false);\n  const timeRef = useRef(null); // Hàm này dùng để mở hộp thoại chat\n\n  const onChat = () => {\n    setActiveChat(!activeChat);\n  };\n\n  const onChangeText = e => {\n    setTextMessage(e.target.value);\n  };\n\n  const handlerSend = () => {\n    if (textMessage.trim() !== '') {\n      const data = {\n        id_user1: id_user,\n        id_user2: id_admin,\n        id: Math.random().toString(),\n        message: textMessage,\n        name: sessionStorage.getItem('name_user'),\n        category: 'send'\n      };\n      const data_partner = {\n        id_user1: id_admin,\n        id_user2: id_user,\n        id: Math.random().toString(),\n        message: textMessage,\n        name: sessionStorage.getItem('name_user'),\n        category: 'receive'\n      };\n      socket.emit('send_message', data);\n\n      const postData = async () => {\n        const query = '?' + queryString.stringify(data);\n        const query_partner = '?' + queryString.stringify(data_partner);\n        await MessengerAPI.postMessage(query);\n        const res = await MessengerAPI.postMessage(query_partner);\n\n        if (res) {\n          setLoad(true);\n        }\n      };\n\n      postData();\n      setTextMessage('');\n    }\n  };\n\n  useEffect(() => {\n    socket.on('receive_message', () => {\n      setLoad(true);\n    });\n    return () => {\n      socket.off('receive_message');\n    };\n  }, []);\n  useEffect(() => {\n    if (activeChat) {\n      handlePollingMessage();\n    } else {\n      clearTimeout(timeRef.current);\n    }\n  }, [activeChat]); // Hàm này dùng để load dữ liệu message của user khi user gửi tin nhán\n\n  const fetchMessageData = async () => {\n    const params = {\n      id_user1: id_user,\n      id_user2: id_admin\n    };\n    const query = '?' + queryString.stringify(params);\n    const response = await MessengerAPI.getMessage(query);\n    setMessage(response.content);\n\n    if (response) {\n      return true;\n    }\n  }; // Hàm này là thay đổi state loadMessage phụ thuộc vào redux id_user\n\n\n  const updateLoadMessage = () => {\n    if (!id_user) {\n      setLoadMessage('');\n    } else {\n      setLoadMessage(id_user);\n    }\n  };\n\n  useEffect(() => {\n    updateLoadMessage();\n  }, [id_user]);\n  useEffect(() => {\n    if (load) {\n      fetchMessageData();\n      setLoad(false);\n    }\n  }, [load]);\n\n  const handlePollingMessage = () => {\n    timeRef.current = setTimeout(async () => {\n      const flag = await fetchMessageData();\n\n      if (flag && activeChat) {\n        handlePollingMessage();\n      }\n    }, 3000);\n  };\n\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: /*#__PURE__*/_jsxDEV(\"div\", {\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"wrapper_chat\",\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"chat_messenger\",\n          onClick: onChat,\n          children: /*#__PURE__*/_jsxDEV(\"svg\", {\n            x: \"0\",\n            y: \"0\",\n            width: \"60px\",\n            height: \"60px\",\n            children: /*#__PURE__*/_jsxDEV(\"g\", {\n              stroke: \"none\",\n              strokeWidth: \"1\",\n              fill: \"none\",\n              fillRule: \"evenodd\",\n              children: /*#__PURE__*/_jsxDEV(\"g\", {\n                children: [/*#__PURE__*/_jsxDEV(\"circle\", {\n                  fill: \"#383838\",\n                  cx: \"30\",\n                  cy: \"30\",\n                  r: \"30\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 138,\n                  columnNumber: 37\n                }, this), /*#__PURE__*/_jsxDEV(\"svg\", {\n                  x: \"10\",\n                  y: \"10\",\n                  children: /*#__PURE__*/_jsxDEV(\"g\", {\n                    transform: \"translate(0.000000, -10.000000)\",\n                    fill: \"#FFFFFF\",\n                    children: /*#__PURE__*/_jsxDEV(\"g\", {\n                      id: \"logo\",\n                      transform: \"translate(0.000000, 10.000000)\",\n                      children: /*#__PURE__*/_jsxDEV(\"path\", {\n                        d: \"M20,0 C31.2666,0 40,8.2528 40,19.4 C40,30.5472 31.2666,38.8  20,38.8 C17.9763,38.8 16.0348,38.5327 14.2106,38.0311 C13.856,37.9335 13.4789,37.9612  13.1424,38.1098 L9.1727,39.8621 C8.1343,40.3205 6.9621,39.5819 6.9273,38.4474 L6.8184,34.8894  C6.805,34.4513 6.6078,34.0414 6.2811,33.7492 C2.3896,30.2691 0,25.2307 0,19.4 C0,8.2528 8.7334,0  20,0 Z M7.99009,25.07344 C7.42629,25.96794 8.52579,26.97594 9.36809,26.33674 L15.67879,21.54734  C16.10569,21.22334 16.69559,21.22164 17.12429,21.54314 L21.79709,25.04774 C23.19919,26.09944  25.20039,25.73014 26.13499,24.24744 L32.00999,14.92654 C32.57369,14.03204 31.47419,13.02404  30.63189,13.66324 L24.32119,18.45264 C23.89429,18.77664 23.30439,18.77834 22.87569,18.45674  L18.20299,14.95224 C16.80079,13.90064 14.79959,14.26984 13.86509,15.75264 L7.99009,25.07344 Z\"\n                      }, void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 142,\n                        columnNumber: 49\n                      }, this)\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 141,\n                      columnNumber: 45\n                    }, this)\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 140,\n                    columnNumber: 41\n                  }, this)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 139,\n                  columnNumber: 37\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 137,\n                columnNumber: 33\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 136,\n              columnNumber: 73\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 136,\n            columnNumber: 29\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 135,\n          columnNumber: 25\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 134,\n        columnNumber: 21\n      }, this), activeChat && /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"active_chat animate__animated animate__jackInTheBox\",\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            width: '100%'\n          },\n          children: /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"card card-bordered fix_boderChat\",\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"card-header\",\n              children: [/*#__PURE__*/_jsxDEV(\"h4\", {\n                className: \"card-title\",\n                children: /*#__PURE__*/_jsxDEV(\"strong\", {\n                  children: \"Customer Support\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 166,\n                  columnNumber: 72\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 166,\n                columnNumber: 45\n              }, this), \" \", /*#__PURE__*/_jsxDEV(\"a\", {\n                className: \"btn btn-xs btn-secondary\",\n                href: \"#\",\n                children: \"Let's Chat App\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 166,\n                columnNumber: 111\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 165,\n              columnNumber: 41\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"ps-container ps-theme-default ps-active-y fix_scoll\",\n              children: message && message.map(value => value.category === 'send' ? /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"media media-chat media-chat-reverse\",\n                children: /*#__PURE__*/_jsxDEV(\"div\", {\n                  className: \"media-body\",\n                  children: /*#__PURE__*/_jsxDEV(\"p\", {\n                    children: value.message\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 174,\n                    columnNumber: 65\n                  }, this)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 173,\n                  columnNumber: 61\n                }, this)\n              }, value.id, false, {\n                fileName: _jsxFileName,\n                lineNumber: 172,\n                columnNumber: 57\n              }, this) : /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"media media-chat\",\n                children: [\" \", /*#__PURE__*/_jsxDEV(\"img\", {\n                  className: \"avatar\",\n                  src: \"https://img.icons8.com/color/36/000000/administrator-male.png\",\n                  alt: \"...\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 178,\n                  columnNumber: 107\n                }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                  className: \"media-body\",\n                  children: /*#__PURE__*/_jsxDEV(\"p\", {\n                    children: [\"ADMIN: \", value.message]\n                  }, void 0, true, {\n                    fileName: _jsxFileName,\n                    lineNumber: 180,\n                    columnNumber: 65\n                  }, this)\n                }, value.id, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 179,\n                  columnNumber: 61\n                }, this)]\n              }, value.id, true, {\n                fileName: _jsxFileName,\n                lineNumber: 178,\n                columnNumber: 57\n              }, this))\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 168,\n              columnNumber: 41\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"publisher bt-1 border-light\",\n              children: [/*#__PURE__*/_jsxDEV(\"img\", {\n                className: \"avatar avatar-xs\",\n                src: \"https://img.icons8.com/color/36/000000/administrator-male.png\",\n                alt: \"...\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 188,\n                columnNumber: 45\n              }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n                type: \"text\",\n                placeholder: \"Enter Message!\",\n                onChange: onChangeText,\n                value: textMessage\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 189,\n                columnNumber: 45\n              }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                className: \"publisher-btn file-group\",\n                children: [/*#__PURE__*/_jsxDEV(\"i\", {\n                  className: \"fa fa-paperclip file-browser\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 191,\n                  columnNumber: 49\n                }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n                  type: \"file\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 192,\n                  columnNumber: 49\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 190,\n                columnNumber: 45\n              }, this), /*#__PURE__*/_jsxDEV(\"a\", {\n                className: \"publisher-btn\",\n                href: \"#\",\n                \"data-abc\": \"true\",\n                children: /*#__PURE__*/_jsxDEV(\"i\", {\n                  className: \"fa fa-smile\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 195,\n                  columnNumber: 49\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 194,\n                columnNumber: 45\n              }, this), /*#__PURE__*/_jsxDEV(\"a\", {\n                onClick: handlerSend,\n                className: \"publisher-btn text-info\",\n                \"data-abc\": \"true\",\n                children: /*#__PURE__*/_jsxDEV(\"i\", {\n                  className: \"fa fa-paper-plane\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 198,\n                  columnNumber: 49\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 197,\n                columnNumber: 45\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 187,\n              columnNumber: 41\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 164,\n            columnNumber: 37\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 163,\n          columnNumber: 33\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 162,\n        columnNumber: 29\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 133,\n      columnNumber: 17\n    }, this)\n  }, void 0, false);\n}\n\n_s(Chat, \"rck4W0BSnkarfJPLrXHHUVFyyr8=\");\n\n_c = Chat;\nexport default Chat;\n\nvar _c;\n\n$RefreshReg$(_c, \"Chat\");","map":{"version":3,"sources":["/Volumes/document/GitHub/ASM3/Frontend Assignment 03/client/src/Share/Chat/Chat.jsx"],"names":["React","useEffect","useRef","useState","queryString","io","MessengerAPI","socket","Chat","activeChat","setActiveChat","textMessage","setTextMessage","message","setMessage","id_admin","id_user","localStorage","getItem","loadMessage","setLoadMessage","load","setLoad","timeRef","onChat","onChangeText","e","target","value","handlerSend","trim","data","id_user1","id_user2","id","Math","random","toString","name","sessionStorage","category","data_partner","emit","postData","query","stringify","query_partner","postMessage","res","on","off","handlePollingMessage","clearTimeout","current","fetchMessageData","params","response","getMessage","content","updateLoadMessage","setTimeout","flag","width","map"],"mappings":"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","sourcesContent":["import React, { useEffect, useRef, useState } from 'react';\nimport './Chat.css';\nimport queryString from 'query-string';\nimport io from 'socket.io-client';\nimport MessengerAPI from '../../API/MessengerAPI';\n\nconst socket = io('http://localhost:5001'); // Thay đổi URL của server Socket.IO tại đây\n\nfunction Chat() {\n  const [activeChat, setActiveChat] = useState(false);\n  const [textMessage, setTextMessage] = useState('');\n  const [message, setMessage] = useState([]);\n  const id_admin = '5ff808424e24e9118cee77b2';\n  const id_user = localStorage.getItem('idUser');\n  const [loadMessage, setLoadMessage] = useState('');\n  const [load, setLoad] = useState(false);\n  const timeRef = useRef(null);\n\n  // Hàm này dùng để mở hộp thoại chat\n  const onChat = () => {\n    setActiveChat(!activeChat);\n  };\n\n  const onChangeText = (e) => {\n    setTextMessage(e.target.value);\n  };\n\n  const handlerSend = () => {\n    if (textMessage.trim() !== '') {\n      const data = {\n        id_user1: id_user,\n        id_user2: id_admin,\n        id: Math.random().toString(),\n        message: textMessage,\n        name: sessionStorage.getItem('name_user'),\n        category: 'send',\n      };\n\n      const data_partner = {\n        id_user1: id_admin,\n        id_user2: id_user,\n        id: Math.random().toString(),\n        message: textMessage,\n        name: sessionStorage.getItem('name_user'),\n        category: 'receive',\n      };\n\n      socket.emit('send_message', data);\n\n      const postData = async () => {\n        const query = '?' + queryString.stringify(data);\n        const query_partner = '?' + queryString.stringify(data_partner);\n\n        await MessengerAPI.postMessage(query);\n        const res = await MessengerAPI.postMessage(query_partner);\n\n        if (res) {\n          setLoad(true);\n        }\n      };\n\n      postData();\n\n      setTextMessage('');\n    }\n  };\n\n  useEffect(() => {\n    socket.on('receive_message', () => {\n      setLoad(true);\n    });\n\n    return () => {\n      socket.off('receive_message');\n    };\n  }, []);\n\n  useEffect(() => {\n    if (activeChat) {\n      handlePollingMessage();\n    } else {\n      clearTimeout(timeRef.current);\n    }\n  }, [activeChat]);\n\n  // Hàm này dùng để load dữ liệu message của user khi user gửi tin nhán\n  const fetchMessageData = async () => {\n    const params = {\n      id_user1: id_user,\n      id_user2: id_admin,\n    };\n    const query = '?' + queryString.stringify(params);\n    const response = await MessengerAPI.getMessage(query);\n    setMessage(response.content);\n    if (response) {\n      return true;\n    }\n  };\n\n  // Hàm này là thay đổi state loadMessage phụ thuộc vào redux id_user\n  const updateLoadMessage = () => {\n    if (!id_user) {\n      setLoadMessage('');\n    } else {\n      setLoadMessage(id_user);\n    }\n  };\n\n  useEffect(() => {\n    updateLoadMessage();\n  }, [id_user]);\n\n  useEffect(() => {\n    if (load) {\n      fetchMessageData();\n      setLoad(false);\n    }\n  }, [load]);\n\n  const handlePollingMessage = () => {\n    timeRef.current = setTimeout(async () => {\n      const flag = await fetchMessageData();\n      if (flag && activeChat) {\n        handlePollingMessage();\n      }\n    }, 3000);\n  };\n\n\n    return (\n        <>\n            {/* {id_user && */}\n                <div>\n                    <div className=\"wrapper_chat\">\n                        <div className=\"chat_messenger\" onClick={onChat}>\n                            <svg x=\"0\" y=\"0\" width=\"60px\" height=\"60px\"><g stroke=\"none\" strokeWidth=\"1\" fill=\"none\" fillRule=\"evenodd\">\n                                <g>\n                                    <circle fill=\"#383838\" cx=\"30\" cy=\"30\" r=\"30\"></circle>\n                                    <svg x=\"10\" y=\"10\">\n                                        <g transform=\"translate(0.000000, -10.000000)\" fill=\"#FFFFFF\">\n                                            <g id=\"logo\" transform=\"translate(0.000000, 10.000000)\">\n                                                <path d=\"M20,0 C31.2666,0 40,8.2528 40,19.4 C40,30.5472 31.2666,38.8 \n                                        20,38.8 C17.9763,38.8 16.0348,38.5327 14.2106,38.0311 C13.856,37.9335 13.4789,37.9612 \n                                        13.1424,38.1098 L9.1727,39.8621 C8.1343,40.3205 6.9621,39.5819 6.9273,38.4474 L6.8184,34.8894 \n                                        C6.805,34.4513 6.6078,34.0414 6.2811,33.7492 C2.3896,30.2691 0,25.2307 0,19.4 C0,8.2528 8.7334,0 \n                                        20,0 Z M7.99009,25.07344 C7.42629,25.96794 8.52579,26.97594 9.36809,26.33674 L15.67879,21.54734 \n                                        C16.10569,21.22334 16.69559,21.22164 17.12429,21.54314 L21.79709,25.04774 C23.19919,26.09944 \n                                        25.20039,25.73014 26.13499,24.24744 L32.00999,14.92654 C32.57369,14.03204 31.47419,13.02404 \n                                        30.63189,13.66324 L24.32119,18.45264 C23.89429,18.77664 23.30439,18.77834 22.87569,18.45674 \n                                        L18.20299,14.95224 C16.80079,13.90064 14.79959,14.26984 13.86509,15.75264 L7.99009,25.07344 Z\">\n                                                </path>\n                                            </g>\n                                        </g>\n                                    </svg>\n                                </g>\n                            </g>\n                            </svg>\n                        </div>\n                    </div>\n                    {\n                        activeChat && (\n                            <div className='active_chat animate__animated animate__jackInTheBox'>\n                                <div style={{ width: '100%' }}>\n                                    <div className=\"card card-bordered fix_boderChat\">\n                                        <div className=\"card-header\">\n                                            <h4 className=\"card-title\"><strong>Customer Support</strong></h4> <a className=\"btn btn-xs btn-secondary\" href=\"#\">Let's Chat App</a>\n                                        </div>\n                                        <div className=\"ps-container ps-theme-default ps-active-y fix_scoll\">\n                                            {\n                                                message && message.map(value => (\n                                                    value.category === 'send' ? (\n                                                        <div className=\"media media-chat media-chat-reverse\" key={value.id}>\n                                                            <div className=\"media-body\">\n                                                                <p>{value.message}</p>\n                                                            </div>\n                                                        </div>\n                                                    ) : (\n                                                        <div className=\"media media-chat\" key={value.id}> <img className=\"avatar\" src=\"https://img.icons8.com/color/36/000000/administrator-male.png\" alt=\"...\" />\n                                                            <div className=\"media-body\" key={value.id}>\n                                                                <p>ADMIN: {value.message}</p>\n                                                            </div>\n                                                        </div>\n                                                    )\n                                                ))\n                                            }\n                                        </div>\n                                        <div className=\"publisher bt-1 border-light\">\n                                            <img className=\"avatar avatar-xs\" src=\"https://img.icons8.com/color/36/000000/administrator-male.png\" alt=\"...\" />\n                                            <input type=\"text\" placeholder=\"Enter Message!\" onChange={onChangeText} value={textMessage} />\n                                            <span className=\"publisher-btn file-group\">\n                                                <i className=\"fa fa-paperclip file-browser\"></i>\n                                                <input type=\"file\" />\n                                            </span>\n                                            <a className=\"publisher-btn\" href=\"#\" data-abc=\"true\">\n                                                <i className=\"fa fa-smile\"></i>\n                                            </a>\n                                            <a onClick={handlerSend} className=\"publisher-btn text-info\" data-abc=\"true\">\n                                                <i className=\"fa fa-paper-plane\"></i>\n                                            </a>\n                                        </div>\n                                    </div>\n                                </div>\n                            </div>\n                        )\n                    }\n                </div>\n            {/* } */}\n        </>\n    );\n}\n\nexport default Chat;"]},"metadata":{},"sourceType":"module"}