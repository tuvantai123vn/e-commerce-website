{"ast":null,"code":"import { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nvar _jsxFileName = \"/Volumes/document/GitHub/ASM3/Frontend Assignment 03/client/src/Share/Chat/Chat.jsx\",\n    _s = $RefreshSig$();\n\nimport React, { useEffect, useRef, useState } from 'react';\nimport './Chat.css';\nimport queryString from 'query-string';\nimport MessengerAPI from '../../API/MessengerAPI';\nimport { useSelector } from 'react-redux';\nimport io from \"socket.io-client\";\nconst socket = io(\"http://localhost:5001\", {\n  withCredentials: true,\n  extraHeaders: {\n    \"my-custom-header\": \"abcd\"\n  }\n});\n\nfunction Chat(props) {\n  _s();\n\n  const [activeChat, setActiveChat] = useState(false);\n  const [textMessage, setTextMessage] = useState('');\n  const [message, setMessage] = useState();\n  const id_admin = '5ff808424e24e9118cee77b2'; //Get id_user từ redux khi user đã đăng nhập\n\n  const id_user = useSelector(state => state.Session.idUser);\n  const [loadMessage, setLoadMessage] = useState('');\n  const [load, setLoad] = useState(false);\n  const timeRef = useRef(null); // Hàm này dùng để mở hộp thoại chat\n\n  const onChat = () => {\n    setActiveChat(!activeChat);\n  };\n\n  const onChangeText = e => {\n    setTextMessage(e.target.value);\n  }; // Hàm này là thay đổi state loadMessage phụ thuộc vào redux id_user\n  // Nhầm mục đích để gọi lại hàm useEffect loadmessage\n\n\n  useEffect(() => {\n    if (!id_user) {\n      setLoadMessage('');\n    } else {\n      setLoadMessage(id_user);\n    }\n  }, [id_user]);\n\n  const handlerSend = () => {\n    //Khi gửi tin nhắn thì nó sẽ lấy id của cả 2 người\n    //Với cái key category có value là send\n    //Vì là gửi tin nhắn\n    const data = {\n      id_user1: id_user,\n      id_user2: id_admin,\n      id: Math.random().toString(),\n      message: textMessage,\n      name: sessionStorage.getItem('name_user'),\n      category: \"send\"\n    }; //Sau đó nó emit dữ liệu lên server bằng socket với key send_message và value data\n\n    socket.emit('send_message', data);\n  }; // Hàm này dùng để load dữ liệu message của user khi user gửi tin nhán\n\n\n  useEffect(() => {\n    if (load) {\n      fetchMessageData();\n      setLoad(false);\n    }\n  }, [load]); // const fetchMessageData = async () => {\n  //     const params = {\n  //         id_user1: id_user,\n  //         id_user2: id_admin\n  //     }\n  //     const query = '?' + queryString.stringify(params)\n  //     const response = await MessengerAPI.getMessage(query)\n  //     setMessage(response.content);\n  //     if (response) {\n  //         return true;\n  //     }\n  // };\n  // Hàm này dùng để load dữ liệu message của user\n  // Phụ thuộc state loadMessage\n  // useEffect(() => {\n  //     if (loadMessage) {\n  //         const fetchData = async () => {\n  //             const params = {\n  //                 id_user1: id_user,\n  //                 id_user2: id_admin\n  //             }\n  //             const query = '?' + queryString.stringify(params)\n  //             const response = await MessengerAPI.getMessage(query)\n  //             setMessage(response.content)\n  //         }\n  //         fetchData()\n  //     }\n  // }, [loadMessage])\n  //Hàm này dùng để nhận socket từ server gửi lên\n\n  useEffect(() => {\n    //Nhận dữ liệu từ server gửi lên thông qua socket với key receive_message\n    socket.on('receive_message', data => {\n      setMessage; //Sau đó nó sẽ setLoad gọi lại hàm useEffect lấy lại dữ liệu\n\n      setLoad(true);\n    });\n  }, []);\n\n  const handlePollingMessage = () => {\n    timeRef.current = setTimeout(async () => {\n      const flag = await fetchMessageData();\n\n      if (flag && activeChat) {\n        handlePollingMessage();\n      }\n    }, 3000);\n  };\n\n  useEffect(() => {\n    if (activeChat) {\n      handlePollingMessage();\n    } else {\n      clearTimeout(timeRef.current);\n    }\n  }, [activeChat]);\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: id_user && /*#__PURE__*/_jsxDEV(\"div\", {\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"wrapper_chat\",\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"chat_messenger\",\n          onClick: onChat,\n          children: /*#__PURE__*/_jsxDEV(\"svg\", {\n            x: \"0\",\n            y: \"0\",\n            width: \"60px\",\n            height: \"60px\",\n            children: /*#__PURE__*/_jsxDEV(\"g\", {\n              stroke: \"none\",\n              strokeWidth: \"1\",\n              fill: \"none\",\n              fillRule: \"evenodd\",\n              children: /*#__PURE__*/_jsxDEV(\"g\", {\n                children: [/*#__PURE__*/_jsxDEV(\"circle\", {\n                  fill: \"#383838\",\n                  cx: \"30\",\n                  cy: \"30\",\n                  r: \"30\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 154,\n                  columnNumber: 37\n                }, this), /*#__PURE__*/_jsxDEV(\"svg\", {\n                  x: \"10\",\n                  y: \"10\",\n                  children: /*#__PURE__*/_jsxDEV(\"g\", {\n                    transform: \"translate(0.000000, -10.000000)\",\n                    fill: \"#FFFFFF\",\n                    children: /*#__PURE__*/_jsxDEV(\"g\", {\n                      id: \"logo\",\n                      transform: \"translate(0.000000, 10.000000)\",\n                      children: /*#__PURE__*/_jsxDEV(\"path\", {\n                        d: \"M20,0 C31.2666,0 40,8.2528 40,19.4 C40,30.5472 31.2666,38.8  20,38.8 C17.9763,38.8 16.0348,38.5327 14.2106,38.0311 C13.856,37.9335 13.4789,37.9612  13.1424,38.1098 L9.1727,39.8621 C8.1343,40.3205 6.9621,39.5819 6.9273,38.4474 L6.8184,34.8894  C6.805,34.4513 6.6078,34.0414 6.2811,33.7492 C2.3896,30.2691 0,25.2307 0,19.4 C0,8.2528 8.7334,0  20,0 Z M7.99009,25.07344 C7.42629,25.96794 8.52579,26.97594 9.36809,26.33674 L15.67879,21.54734  C16.10569,21.22334 16.69559,21.22164 17.12429,21.54314 L21.79709,25.04774 C23.19919,26.09944  25.20039,25.73014 26.13499,24.24744 L32.00999,14.92654 C32.57369,14.03204 31.47419,13.02404  30.63189,13.66324 L24.32119,18.45264 C23.89429,18.77664 23.30439,18.77834 22.87569,18.45674  L18.20299,14.95224 C16.80079,13.90064 14.79959,14.26984 13.86509,15.75264 L7.99009,25.07344 Z\"\n                      }, void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 158,\n                        columnNumber: 49\n                      }, this)\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 157,\n                      columnNumber: 45\n                    }, this)\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 156,\n                    columnNumber: 41\n                  }, this)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 155,\n                  columnNumber: 37\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 153,\n                columnNumber: 33\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 152,\n              columnNumber: 73\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 152,\n            columnNumber: 29\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 151,\n          columnNumber: 25\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 150,\n        columnNumber: 21\n      }, this), activeChat && /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"active_chat animate__animated animate__jackInTheBox\",\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            width: '100%'\n          },\n          children: /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"card card-bordered fix_boderChat\",\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"card-header\",\n              children: [/*#__PURE__*/_jsxDEV(\"h4\", {\n                className: \"card-title\",\n                children: /*#__PURE__*/_jsxDEV(\"strong\", {\n                  children: \"Customer Support\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 182,\n                  columnNumber: 72\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 182,\n                columnNumber: 45\n              }, this), \" \", /*#__PURE__*/_jsxDEV(\"a\", {\n                className: \"btn btn-xs btn-secondary\",\n                href: \"#\",\n                children: \"Let's Chat App\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 182,\n                columnNumber: 111\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 181,\n              columnNumber: 41\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"ps-container ps-theme-default ps-active-y fix_scoll\",\n              children: message && message.map(value => value.category === 'send' ? /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"media media-chat media-chat-reverse\",\n                children: /*#__PURE__*/_jsxDEV(\"div\", {\n                  className: \"media-body\",\n                  children: /*#__PURE__*/_jsxDEV(\"p\", {\n                    children: value.message\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 190,\n                    columnNumber: 65\n                  }, this)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 189,\n                  columnNumber: 61\n                }, this)\n              }, value.id, false, {\n                fileName: _jsxFileName,\n                lineNumber: 188,\n                columnNumber: 57\n              }, this) : /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"media media-chat\",\n                children: [\" \", /*#__PURE__*/_jsxDEV(\"img\", {\n                  className: \"avatar\",\n                  src: \"https://img.icons8.com/color/36/000000/administrator-male.png\",\n                  alt: \"...\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 194,\n                  columnNumber: 107\n                }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                  className: \"media-body\",\n                  children: /*#__PURE__*/_jsxDEV(\"p\", {\n                    children: [\"ADMIN: \", value.message]\n                  }, void 0, true, {\n                    fileName: _jsxFileName,\n                    lineNumber: 196,\n                    columnNumber: 65\n                  }, this)\n                }, value.id, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 195,\n                  columnNumber: 61\n                }, this)]\n              }, value.id, true, {\n                fileName: _jsxFileName,\n                lineNumber: 194,\n                columnNumber: 57\n              }, this))\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 184,\n              columnNumber: 41\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"publisher bt-1 border-light\",\n              children: [/*#__PURE__*/_jsxDEV(\"img\", {\n                className: \"avatar avatar-xs\",\n                src: \"https://img.icons8.com/color/36/000000/administrator-male.png\",\n                alt: \"...\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 204,\n                columnNumber: 45\n              }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n                type: \"text\",\n                placeholder: \"Enter Message!\",\n                onChange: onChangeText,\n                value: textMessage\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 205,\n                columnNumber: 45\n              }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                className: \"publisher-btn file-group\",\n                children: [/*#__PURE__*/_jsxDEV(\"i\", {\n                  className: \"fa fa-paperclip file-browser\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 207,\n                  columnNumber: 49\n                }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n                  type: \"file\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 208,\n                  columnNumber: 49\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 206,\n                columnNumber: 45\n              }, this), /*#__PURE__*/_jsxDEV(\"a\", {\n                className: \"publisher-btn\",\n                href: \"#\",\n                \"data-abc\": \"true\",\n                children: /*#__PURE__*/_jsxDEV(\"i\", {\n                  className: \"fa fa-smile\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 211,\n                  columnNumber: 49\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 210,\n                columnNumber: 45\n              }, this), /*#__PURE__*/_jsxDEV(\"a\", {\n                onClick: handlerSend,\n                className: \"publisher-btn text-info\",\n                \"data-abc\": \"true\",\n                children: /*#__PURE__*/_jsxDEV(\"i\", {\n                  className: \"fa fa-paper-plane\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 214,\n                  columnNumber: 49\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 213,\n                columnNumber: 45\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 203,\n              columnNumber: 41\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 180,\n            columnNumber: 37\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 179,\n          columnNumber: 33\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 178,\n        columnNumber: 29\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 149,\n      columnNumber: 17\n    }, this)\n  }, void 0, false);\n}\n\n_s(Chat, \"1Stg1IZHYZ9vDGWIYpv3kBwO0EE=\", false, function () {\n  return [useSelector];\n});\n\n_c = Chat;\nexport default Chat;\n\nvar _c;\n\n$RefreshReg$(_c, \"Chat\");","map":{"version":3,"sources":["/Volumes/document/GitHub/ASM3/Frontend Assignment 03/client/src/Share/Chat/Chat.jsx"],"names":["React","useEffect","useRef","useState","queryString","MessengerAPI","useSelector","io","socket","withCredentials","extraHeaders","Chat","props","activeChat","setActiveChat","textMessage","setTextMessage","message","setMessage","id_admin","id_user","state","Session","idUser","loadMessage","setLoadMessage","load","setLoad","timeRef","onChat","onChangeText","e","target","value","handlerSend","data","id_user1","id_user2","id","Math","random","toString","name","sessionStorage","getItem","category","emit","fetchMessageData","on","handlePollingMessage","current","setTimeout","flag","clearTimeout","width","map"],"mappings":"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","sourcesContent":["import React, { useEffect, useRef, useState } from 'react';\nimport './Chat.css'\nimport queryString from 'query-string'\n\nimport MessengerAPI from '../../API/MessengerAPI';\nimport { useSelector } from 'react-redux';\n\nimport io from \"socket.io-client\";\nconst socket = io(\"http://localhost:5001\", {\n    withCredentials: true,\n    extraHeaders: {\n      \"my-custom-header\": \"abcd\"\n    }\n});\n\nfunction Chat(props) {\n\n    const [activeChat, setActiveChat] = useState(false)\n\n    const [textMessage, setTextMessage] = useState('')\n\n    const [message, setMessage] = useState()\n\n    const id_admin = '5ff808424e24e9118cee77b2'\n\n    //Get id_user từ redux khi user đã đăng nhập\n    const id_user = useSelector(state => state.Session.idUser)\n\n    const [loadMessage, setLoadMessage] = useState('')\n\n    const [load, setLoad] = useState(false)\n\n    const timeRef = useRef(null);\n\n    // Hàm này dùng để mở hộp thoại chat\n    const onChat = () => {\n        setActiveChat(!activeChat)\n    }\n\n    const onChangeText = (e) => {\n\n        setTextMessage(e.target.value)\n\n    }\n\n    // Hàm này là thay đổi state loadMessage phụ thuộc vào redux id_user\n    // Nhầm mục đích để gọi lại hàm useEffect loadmessage\n    useEffect(() => {\n        if (!id_user) {\n            setLoadMessage('')\n        } else {\n            setLoadMessage(id_user)\n        }\n    }, [id_user])\n\n\n    const handlerSend = () => {\n        //Khi gửi tin nhắn thì nó sẽ lấy id của cả 2 người\n        //Với cái key category có value là send\n        //Vì là gửi tin nhắn\n        const data = {\n            id_user1: id_user,\n            id_user2: id_admin,\n            id: Math.random().toString(),\n            message: textMessage,\n            name: sessionStorage.getItem('name_user'),\n            category: \"send\"\n        }\n        //Sau đó nó emit dữ liệu lên server bằng socket với key send_message và value data\n        socket.emit('send_message', data)\n      }\n\n    // Hàm này dùng để load dữ liệu message của user khi user gửi tin nhán\n    useEffect(() => {\n        if (load) {\n            fetchMessageData();\n            setLoad(false)\n        }\n    }, [load])\n\n    // const fetchMessageData = async () => {\n    //     const params = {\n    //         id_user1: id_user,\n    //         id_user2: id_admin\n    //     }\n    //     const query = '?' + queryString.stringify(params)\n    //     const response = await MessengerAPI.getMessage(query)\n    //     setMessage(response.content);\n    //     if (response) {\n    //         return true;\n    //     }\n    // };\n\n\n    // Hàm này dùng để load dữ liệu message của user\n    // Phụ thuộc state loadMessage\n    // useEffect(() => {\n    //     if (loadMessage) {\n    //         const fetchData = async () => {\n    //             const params = {\n    //                 id_user1: id_user,\n    //                 id_user2: id_admin\n    //             }\n    //             const query = '?' + queryString.stringify(params)\n    //             const response = await MessengerAPI.getMessage(query)\n    //             setMessage(response.content)\n    //         }\n    //         fetchData()\n    //     }\n    // }, [loadMessage])\n\n\n    //Hàm này dùng để nhận socket từ server gửi lên\n    useEffect(() => {\n\n        //Nhận dữ liệu từ server gửi lên thông qua socket với key receive_message\n        socket.on('receive_message', (data) => {\n\n          setMessage\n\n            //Sau đó nó sẽ setLoad gọi lại hàm useEffect lấy lại dữ liệu\n            setLoad(true)\n\n        })\n\n    }, [])\n\n    const handlePollingMessage = () => {\n        timeRef.current = setTimeout(async () => {\n            const flag = await fetchMessageData();\n            if (flag && activeChat) {\n                handlePollingMessage();\n            }\n        }, 3000);\n    }\n\n    useEffect(() => {\n        if (activeChat) {\n            handlePollingMessage();\n        } else {\n            clearTimeout(timeRef.current);\n        }\n    }, [activeChat])\n\n\n    return (\n        <>\n            {id_user &&\n                <div>\n                    <div className=\"wrapper_chat\">\n                        <div className=\"chat_messenger\" onClick={onChat}>\n                            <svg x=\"0\" y=\"0\" width=\"60px\" height=\"60px\"><g stroke=\"none\" strokeWidth=\"1\" fill=\"none\" fillRule=\"evenodd\">\n                                <g>\n                                    <circle fill=\"#383838\" cx=\"30\" cy=\"30\" r=\"30\"></circle>\n                                    <svg x=\"10\" y=\"10\">\n                                        <g transform=\"translate(0.000000, -10.000000)\" fill=\"#FFFFFF\">\n                                            <g id=\"logo\" transform=\"translate(0.000000, 10.000000)\">\n                                                <path d=\"M20,0 C31.2666,0 40,8.2528 40,19.4 C40,30.5472 31.2666,38.8 \n                                        20,38.8 C17.9763,38.8 16.0348,38.5327 14.2106,38.0311 C13.856,37.9335 13.4789,37.9612 \n                                        13.1424,38.1098 L9.1727,39.8621 C8.1343,40.3205 6.9621,39.5819 6.9273,38.4474 L6.8184,34.8894 \n                                        C6.805,34.4513 6.6078,34.0414 6.2811,33.7492 C2.3896,30.2691 0,25.2307 0,19.4 C0,8.2528 8.7334,0 \n                                        20,0 Z M7.99009,25.07344 C7.42629,25.96794 8.52579,26.97594 9.36809,26.33674 L15.67879,21.54734 \n                                        C16.10569,21.22334 16.69559,21.22164 17.12429,21.54314 L21.79709,25.04774 C23.19919,26.09944 \n                                        25.20039,25.73014 26.13499,24.24744 L32.00999,14.92654 C32.57369,14.03204 31.47419,13.02404 \n                                        30.63189,13.66324 L24.32119,18.45264 C23.89429,18.77664 23.30439,18.77834 22.87569,18.45674 \n                                        L18.20299,14.95224 C16.80079,13.90064 14.79959,14.26984 13.86509,15.75264 L7.99009,25.07344 Z\">\n                                                </path>\n                                            </g>\n                                        </g>\n                                    </svg>\n                                </g>\n                            </g>\n                            </svg>\n                        </div>\n                    </div>\n                    {\n                        activeChat && (\n                            <div className='active_chat animate__animated animate__jackInTheBox'>\n                                <div style={{ width: '100%' }}>\n                                    <div className=\"card card-bordered fix_boderChat\">\n                                        <div className=\"card-header\">\n                                            <h4 className=\"card-title\"><strong>Customer Support</strong></h4> <a className=\"btn btn-xs btn-secondary\" href=\"#\">Let's Chat App</a>\n                                        </div>\n                                        <div className=\"ps-container ps-theme-default ps-active-y fix_scoll\">\n                                            {\n                                                message && message.map(value => (\n                                                    value.category === 'send' ? (\n                                                        <div className=\"media media-chat media-chat-reverse\" key={value.id}>\n                                                            <div className=\"media-body\">\n                                                                <p>{value.message}</p>\n                                                            </div>\n                                                        </div>\n                                                    ) : (\n                                                        <div className=\"media media-chat\" key={value.id}> <img className=\"avatar\" src=\"https://img.icons8.com/color/36/000000/administrator-male.png\" alt=\"...\" />\n                                                            <div className=\"media-body\" key={value.id}>\n                                                                <p>ADMIN: {value.message}</p>\n                                                            </div>\n                                                        </div>\n                                                    )\n                                                ))\n                                            }\n                                        </div>\n                                        <div className=\"publisher bt-1 border-light\">\n                                            <img className=\"avatar avatar-xs\" src=\"https://img.icons8.com/color/36/000000/administrator-male.png\" alt=\"...\" />\n                                            <input type=\"text\" placeholder=\"Enter Message!\" onChange={onChangeText} value={textMessage} />\n                                            <span className=\"publisher-btn file-group\">\n                                                <i className=\"fa fa-paperclip file-browser\"></i>\n                                                <input type=\"file\" />\n                                            </span>\n                                            <a className=\"publisher-btn\" href=\"#\" data-abc=\"true\">\n                                                <i className=\"fa fa-smile\"></i>\n                                            </a>\n                                            <a onClick={handlerSend} className=\"publisher-btn text-info\" data-abc=\"true\">\n                                                <i className=\"fa fa-paper-plane\"></i>\n                                            </a>\n                                        </div>\n                                    </div>\n                                </div>\n                            </div>\n                        )\n                    }\n                </div>\n            }\n        </>\n    );\n}\n\nexport default Chat;"]},"metadata":{},"sourceType":"module"}